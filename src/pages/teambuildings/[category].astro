---
import Layout from '../../layouts/Layout.astro';
import { TeamActivitiesList } from '@/components/TeamActivitiesList';
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';

// Generate static paths for each category
export async function getStaticPaths() {
  const categories = await getCollection('categories');
  return categories.map(category => ({
    params: { category: category.id },
    props: { categoryId: category.id },
  }));
}

const { categoryId } = Astro.props;

// Get all categories for the filters
const categoriesCollection = await getCollection('categories');
const categories = categoriesCollection.map(cat => ({
  id: cat.id,
  title: cat.data.title,
  description: cat.data.description
}));

// Get all activities
const allActivities = await getCollection('activities');

// Filter activities for this category
const filteredActivities = allActivities.filter(activity => 
  activity.data.category === categoryId || 
  activity.data.categories?.includes(categoryId)
);

// Transform filtered activities
const activities = filteredActivities.map((activity: CollectionEntry<'activities'>) => ({
  id: activity.slug,
  title: activity.data.title,
  description: activity.data.description,
  image: activity.data.image,
  category: activity.data.category,
  categories: activity.data.categories || [],
  duration: activity.data.duration,
  groupSize: activity.data.groupSize,
  price: activity.data.price,
  availability: activity.data.availability,
  features: activity.data.features || [],
  gallery: activity.data.gallery || []
}));
---

<Layout title={`${categories.find(c => c.id === categoryId)?.title || 'Activities'} - ActionMaker`}>
  <main class="min-h-screen pt-24 pb-32">
    <TeamActivitiesList 
      client:load 
      selectedCategory={categoryId}
      initialActivities={activities}
      categories={categories}
    />
  </main>
</Layout>