---
import { localizePath } from 'astro-i18next';
import i18next, { t } from 'i18next';

interface Category {
  id: string;
  title: string;
  description: string;
}

interface Props {
  categories: Category[];
  selectedCategory: string | null;
  fromHomepage?: boolean;
}

const { categories, selectedCategory, fromHomepage = false } = Astro.props;
const currentLocale = i18next.language;

// Get clean category ID without locale prefix
const getCleanCategoryId = (id: string) => {
  return id.replace(`${currentLocale}/`, '');
};

// Base URL should always be /teambuildings when not on homepage
const baseUrl = fromHomepage ? '/teambuildings' : '';
---

<div class="flex flex-wrap justify-center gap-4 mb-16">
  <a
    href={localizePath(`/teambuildings`)}
    class:list={[
      'px-4 py-2 rounded-full border transition-colors',
      !selectedCategory
        ? 'bg-red-600 text-white border-red-600'
        : 'border-gray-200 hover:border-red-600 hover:text-red-600',
    ]}
  >
    {t('teambuildings:all-activities')}
  </a>
  {
    categories.map((category) => {
      const cleanId = getCleanCategoryId(category.id);
      return (
        <a
          href={localizePath(`/teambuildings?category=${cleanId}#activities-section`)}
          class:list={[
            'px-4 py-2 rounded-full border transition-colors',
            selectedCategory === cleanId
              ? 'bg-red-600 text-white border-red-600'
              : 'border-gray-200 hover:border-red-600 hover:text-red-600',
          ]}
        >
          {category.title}
        </a>
      );
    })
  }
</div>

<script>
  // Add client-side handling to ensure URL parameters are cleared
  document.querySelector('[data-category="all"]')?.addEventListener('click', (e) => {
    e.preventDefault();
    window.location.href = '/teambuildings#activities-section';
  });
</script>
