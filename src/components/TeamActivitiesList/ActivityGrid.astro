---
import { Card } from '@/components/ui/card';
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import i18next from 'i18next';

interface Props {
  activities: {
    id: string;
    title: string;
    description: string;
    image: string;
    categories: string[];
  }[];
  imageImports: Record<string, { default: ImageMetadata }>;
}

const { activities, imageImports } = Astro.props;
const currentLocale = i18next.language;

// Create URL based on locale
const getActivityUrl = (activityId: string) => {
  // Remove locale prefix and .md extension
  const cleanId = activityId.replace(`${currentLocale}/`, '').replace('.md', '');

  // For Dutch (default locale), don't include locale in URL
  if (currentLocale === 'nl') {
    return `/teambuildings/${cleanId}`;
  }
  // For other locales, include locale prefix
  return `/${currentLocale}/teambuildings/${cleanId}`;
};
---

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
  {
    activities.map((activity) => {
      const imagePath = `/src/assets/activities/${activity.image}`;
      const imageData = imageImports[imagePath]?.default;

      if (!imageData) {
        console.error(`Image not found: ${imagePath}`);
        return null;
      }

      return (
        <a href={getActivityUrl(activity.id)} class="block">
          <Card className="group overflow-hidden transition-all duration-300 hover:shadow-xl">
            <div class="relative h-72 overflow-hidden">
              <Image
                src={imageData}
                alt={activity.title}
                width={800}
                height={600}
                class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
              />
              <div class="absolute inset-0 bg-black/40 transition-opacity duration-300 group-hover:opacity-70" />
            </div>
            <div class="p-6">
              <h3 class="text-xl font-bold mb-2">{activity.title}</h3>
              <p class="text-sm text-muted-foreground line-clamp-2">{activity.description}</p>
            </div>
          </Card>
        </a>
      );
    })
  }
</div>
